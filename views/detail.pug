extends layout.pug

block content
        .container
                .jumbotron.text-center
                        h1.fa.fa-comments What a poll!
                .container.jumbotron
                        h2 #{poll.title}
                        .container.col-sm-6.well
                            form(id="votingpoll" name="voteforpoll" action="/poll/"+poll._id+"/answer" method="post")
                                .form-group
                                    .col-xs-6
                                        select(name="answerselected").form-control
                                          each answer in answers
                                            option(value=answer._id) #{answer.title}
                                div.text-center.col-xs-6
                                            button(type="submit").btn.btn-success.btn-lg Vote 
                        .container.col-sm-6.well
                            p no result to display yet
                            canvas#mychart(width="400", height="400")
                script(type='text/javascript').
                    /*Function to update the chart*/
                    $(document).ready(function(){
                        var updateChart = function(){
                        var ctx = $('#mychart'); //The chart that is going to be updated
                        console.log("I'll update the chart");
                        var myChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
                                datasets: [{
                                    label: '# of Votes',
                                    data: [12, 19, 3, 5, 2, 3],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)',
                                        'rgba(255, 206, 86, 0.2)',
                                        'rgba(75, 192, 192, 0.2)',
                                        'rgba(153, 102, 255, 0.2)',
                                        'rgba(255, 159, 64, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255,99,132,1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(153, 102, 255, 1)',
                                        'rgba(255, 159, 64, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero:true
                                        }
                                    }]
                                }
                            }
                        });
                    }
                        /*Function to vote*/
                    $('#votingpoll').submit(function(event) {
                        console.log("In the good func");
                            event.preventDefault(); // Stops browser from navigating away from page
                            var url = "/poll/"+"#{poll._id}"+"/answer";
                            $.post(url, function( data ) {
                              updateChart();
                              alert(data);
                              
                            });
                        });
                    });
                    
        script(src='/js/Chart.js')